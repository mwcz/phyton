{% extends "admin/base_site.html" %}
{% load i18n admin_modify adminmedia %}

{% block extrahead %}{{ block.super }}
{% url admin:jsi18n as jsi18nurl %}
<!-- CHANGE FORM -->
<script type="text/javascript" src="{{ jsi18nurl|default:"../../../jsi18n/" }}"></script>
{{ media }}

<!-- clayto.org javascripts and stylesheets -->
        <link rel="stylesheet" type="text/css" href="/site_media/preview/css/home.css"   media="all" />

        <style type="text/css">

            div#image #photograph 
            {
              border: 1px solid #3C3C3C;
              padding: 2px;
            }

        </style>

        <script type="text/javascript" src="/site_media/preview/js/jquery/jquery-1.3.1.min.js"></script> 
        <script type="text/javascript" src="/site_media/preview/js/colorspace/colorspace.js"></script> 
        <script type="text/javascript" src="/site_media/preview/js/jsimage/JSImage.js"></script> 

        <script type="text/javascript">


            // make canvi public so I can play with it in firebug more easily
            var stroke_tl; 
            var stroke_tr;


            $(document).ready( function() { 

                // Initialize the two JSImage objects, one for each brush stroke
                stroke_tl  = new JSImage( "stroke_tl",  "/site_media/preview/image/wires/wires_tl.png" );
                stroke_tr  = new JSImage( "stroke_tr",  "/site_media/preview/image/wires/wires_tr.png" );
                photograph = new JSImage( "photograph", "/site_media/preview/image/wires/wires.png" );

                $("#selected label:selected").each( function() {
                    $( this ).css("background-color","#222");
                    console.log("A");
                });

                /******************************************************************
                 * The two tools (eyedropper and area eyedropper) have icons that *
                 * change when they are selected.                                 *
                 ******************************************************************/

                $("#eyedropper_label").mousedown( function() {
                    $("#eyedropper_label img").attr("src","/site_media/preview/eyedropper_selected.png");
                    $("#areadropper_label img").attr("src","/site_media/preview/areadropper.png");
                });

                $("#areadropper_label").mousedown( function() {
                    $("#eyedropper_label img").attr("src","/site_media/preview/eyedropper.png");
                    $("#areadropper_label img").attr("src","/site_media/preview/areadropper_selected.png");
                });

                $("#selected label").mousedown( function() {
                    $("#selected label").css("background-color","#000");
                    $( this ).css("background-color","#222");
                });

            });


            function set_primary( r, g, b ) {

                switch( $("#selected input:checked").val() ) {

                    case "strokes":

                        stroke_tl.load_image( "/site_media/preview/image/wires/wires_tl.png" ); 
                        stroke_tr.load_image( "/site_media/preview/image/wires/wires_tr.png" ); 

                        stroke_tl.multiply( null, r, g , b );
                        stroke_tr.multiply( null, r, g , b );

                        break;

                    case "border":

                        document.getElementById("photograph").style.borderColor="rgb(" + r + "," + g + "," + b + ")";
                        break;

                    case "title":

                        document.getElementById("title").style.color="rgb(" + r + "," + g + "," + b + ")";
                        break;

                    case "nav":

                        $("#nav a").css( "color", "rgb(" + r + "," + g + "," + b + ")" );
                        break;

                    case "post":

                        document.getElementById("post").style.color="rgb(" + r + "," + g + "," + b + ")";
                        break;

                    case "caption":

                        document.getElementById("caption").style.color="rgb(" + r + "," + g + "," + b + ")";
                        break;

                    default:

                        break;

                }

            }

            pixel = function(e) {

                var cnvs = photograph.canvas;
                var x = e.pageX - cnvs.offsetLeft;
                var y = e.pageY - cnvs.offsetTop;
                var imgdata = cnvs.getImageData( x, y, 1, 1 );
                var new_color = [ imgdata.data[0], imgdata.data[1], imgdata.data[2] ];

                set_primary( new_color[0], new_color[1], new_color[2] );

            }

            function activate_eyedropper() {

                $("#photograph").mousedown( function(e) {
                    $(this).mousemove( pixel ); // fire pixel() while user is dragging
                    $(this).click( pixel );     // only so it will still fire if user doesn't drag at all
                });

                $("#photograph").mouseup( function() {
                    photograph.canvas.onmousemove = null;
                });

            }

            function activate_areadropper() {


            }

        </script>
<!-- /clayto.org javascripts and stylesheets -->

{% endblock %}

{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% admin_media_prefix %}css/forms.css" />{% endblock %}

{% block coltype %}{% if ordered_objects %}colMS{% else %}colM{% endif %}{% endblock %}

{% block bodyclass %}{{ opts.app_label }}-{{ opts.object_name.lower }} change-form{% endblock %}

{% block breadcrumbs %}{% if not is_popup %}
<div class="breadcrumbs">
     <a href="../../../">{% trans "Home" %}</a> &rsaquo;
     <a href="../../">{{ app_label|capfirst|escape }}</a> &rsaquo; 
     {% if has_change_permission %}<a href="../">{{ opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %} &rsaquo; 
     {% if add %}{% trans "Add" %} {{ opts.verbose_name }}{% else %}{{ original|truncatewords:"18" }}{% endif %}
</div>
{% endif %}{% endblock %}

{% block content %}<div id="content-main">
{% block object-tools %}
{% if change %}{% if not is_popup %}
  <ul class="object-tools"><li><a href="history/" class="historylink">{% trans "History" %}</a></li>
  {% if has_absolute_url %}<li><a href="../../../r/{{ content_type_id }}/{{ object_id }}/" class="viewsitelink">{% trans "View on site" %}</a></li>{% endif%}
  </ul>
{% endif %}{% endif %}
{% endblock %}
<form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.module_name }}_form">{% csrf_token %}{% block form_top %}{% endblock %}
<div>
{% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
{% if save_on_top %}{% submit_row %}{% endif %}
{% if errors %}
    <p class="errornote">
    {% blocktrans count errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
    </p>
    {{ adminform.form.non_field_errors }}
{% endif %}

<!-- relative positioned container so internal elements can be positioned absolutely -->
<div id="cincture">

{% for fieldset in adminform %}
    <fieldset class="module aligned {{ fieldset.classes }}">
        {% if fieldset.name %}<h2>{{ fieldset.name }}</h2>{% endif %}
        {% if fieldset.description %}
            <div class="description">{{ fieldset.description|safe }}</div>
        {% endif %}
            <div class="form-row{% if line.errors %} errors{% endif %} {% for field in line %}{{ field.field.name }} {% endfor %} ">
        {% for line in fieldset %}
                {{ line.errors }}
                {% for field in line %}

                    {% if not "palette" in field.field.name and False %}
                    <div{% if not line.fields|length_is:"1" %} class="field-box"{% endif %} >
                    {% endif %}

                        {{ field.field }}

                        {% if field.field.field.help_text %}
                            <p class="help">{{ field.field.field.help_text|safe }}</p>
                        {% endif %}

                    {% if not "palette" in field.field.name and False %}
                    </div>
                    {% endif %}
                {% endfor %}
        {% endfor %}
            </div>
    </fieldset>
{% endfor %}

</div>





{% block after_field_sets %}{% endblock %}

{% for inline_admin_formset in inline_admin_formsets %}
    {% include inline_admin_formset.opts.template %}
{% endfor %}

{% block after_related_objects %}{% endblock %}

{% submit_row %}

{% if adminform and add %}
   <script type="text/javascript">document.getElementById("{{ adminform.first_field.auto_id }}").focus();</script>
{% endif %}

{# JavaScript for prepopulated fields #}
{% prepopulated_fields_js %}

</div>
</form></div>
{% endblock %}
